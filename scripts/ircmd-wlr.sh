#!/bin/sh

# read configuration
[ -r conf ] && . ./conf

irsend_cmd() {
	[ $debug -eq 1 ] && echo "Sending data:\n$1"
	[ $debug -eq 1 ] && echo "Executing: curl -s \"http://$tasmota_ircmd_ip/cm?cmnd=IrSend%200,$1\""
	last_cmd=$1
	curl -s "http://$tasmota_ircmd_ip/cm?cmnd=IrSend%200,$1"|jq .IRSend
	sleep 0.3
	[ $debug -eq 1 ] && sleep 5
}

data_close_left='550,1075,1365,210,1390,265,575,1110,495,1135,1310,265,575,1080,525,1135,495,1105,1340,265,1360,270,575,1075,1340,270,570,1110,495,1105,530,1105,1370,210,600,1110,490,1135,1310,260,1395,210,1415,210,580,1100,550,19910,550,1080,1370,205,1425,200,605,1080,525,1135,1310,265,550,1135,495,1135,495,1135,1310,260,1370,265,550,1110,1335,265,550,1105,520,1105,520,1105,1340,270,550,1105,520,1110,1335,270,1360,265,1360,270,545,1110,520'
data_close_right='515,1140,1300,275,1355,280,540,1110,1330,275,560,1120,490,1140,490,1140,485,1140,1300,275,1380,235,560,1140,1300,275,550,1130,490,1110,520,1140,1300,275,540,1110,515,1115,1330,275,1350,280,535,1140,485,1140,1300,19165,540,1120,1300,275,1350,275,540,1140,1300,280,560,1115,490,1140,510,1120,490,1140,1300,280,1350,280,560,1115,1300,280,535,1140,485,1110,515,1140,1300,280,560,1085,520,1110,1330,280,1350,275,535,1140,485,1140,1300'
data_open_left='485,1140,490,1135,1310,315,495,1140,490,1135,1310,320,500,1135,495,1135,495,1135,1335,275,1325,320,490,1140,1305,320,490,1140,495,1135,490,1140,1280,345,475,1155,490,1140,1310,320,1285,345,470,1160,490,1145,1300,19160,500,1130,475,1150,1280,350,465,1160,480,1150,1280,350,465,1160,440,1190,465,1165,1255,375,1255,375,440,1185,1255,375,440,1190,440,1190,440,1190,1255,375,440,1195,435,1185,1255,375,1255,375,440,1190,440,1190,1255'
data_open_right='490,1135,495,1135,1305,320,500,1135,1305,320,500,1135,490,1135,495,1135,495,1135,1310,320,1310,320,495,1140,1305,320,495,1140,490,1135,490,1140,1305,320,500,1135,490,1140,1305,320,1310,320,1310,320,485,1145,490,20010,485,1140,485,1140,1310,315,480,1155,1310,320,470,1160,490,1140,480,1145,490,1140,1305,320,1290,340,470,1160,1305,320,470,1160,490,1135,490,1140,1310,320,470,1165,465,1160,1310,320,1290,340,1280,350,465,1160,470'

while true; do
clear
	echo "
============================================
    IR-COM - WINDOW MASTER 'WLR 100 0301'
============================================
Connecting to device: [$tasmota_ircmd_ip]

Available commands:
	1) Open left	[M1/1]
	2) Open right	[M2/1]
	3) Close left	[M1/1]
	4) Close right	[M2/1]

# re-do last command
Press ENTER to re-do last command (currently: $(test -n "$last_cmd" && echo $last_cmd_id || echo none)).
	"

	read -p "Enter command #: " cmd
	test -n "$cmd" && last_cmd_id=$cmd
	case $cmd in
	1) irsend_cmd $data_open_left;;
	2) irsend_cmd $data_open_right;;
	3) irsend_cmd $data_close_left;;
	4) irsend_cmd $data_close_right;;
	"") test -n "$last_cmd" && irsend_cmd $last_cmd || (echo "No last command cached...";sleep 1);;
	*) echo "Command '$cmd' not available...";sleep 1;;
	esac

done
